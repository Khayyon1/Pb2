!function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){const n=o(1),i=o(3),r=o(6),s=o(7);let l=new i(document);r(new n(s.WordCompleteModel,s.WordPredictModel,l,document))},function(t,e,o){var n=o(2);t.exports=class{constructor(t,e,o,n=n,i=!0,r=!0){this.wordCompleteModel=t,this.wordPredictModel=e,this.displayStrategy=o,this.shortcuts=["1","2","3"],this.document=n,this.wordPredictEnabled=r,this.wordCompleteEnabled=i,this.enabled=!0,this.registerListeners()}setDocument(t){this.document=t}async getAppropriateSuggestions(){var t,e,o,i=this.document.activeElement;if(n.isContentEditableDiv(i)){let r=n.caretAndTextOfEditableDiv(i,window.getSelection().baseNode);t=r[t],o=r.text,console.log("TEXT: "+o),e=r.text.charAt(t-1),r.text.charAt(t)}else t=i.selectionStart,e=(o=i.value).charAt(t-1),o.charAt(t);let r=this.getCurrentWord(o,t);if(" "!=e&&this.wordCompleteEnabled)return await this.getSuggestions(r);var s=" "==e;return!this.inputIsNotValid(r)||s||!char_at_caret||this.wordPredictEnabled?await this.getNextWordSuggestion(o.trim()):void 0}async displaySuggestions(){if(!n.activeElementIsServiceable()||""==this.document.activeElement.value)return void this.displayStrategy.tearDown();let t=await this.getAppropriateSuggestions();if(null!=t&&0!=t.length){this.mappings={};for(let e=0;e<t.length;e++){let o=this.shortcuts[e],n=t[e];this.mappings[o]=n}this.displayStrategy.tearDown(),this.displayStrategy.display(this.mappings)}else this.displayStrategy.tearDown()}wordCompletion(t,e){t.value=this.replaceWordAt(t.value,t.selectionStart,e)}replaceWordAt(t,e,o,n=" "){var i=t.lastIndexOf(n,e-1),r=t.substring(0,i);""!=r&&null!=r&&(r+=" ");var s=t.substring(e);return""!=s.charAt(0)&&" "!=s.charAt(0)&&(s=" "+s),r+o+s}getCurrentWord(t,e){if(0==e)return"";var o=t.charAt(e-1);if(" "===o&&(o=t.charAt(e-2),e-=1),o.match(/\w/)){var n=this.indexOfStartOfCurrentWord(t,e);return 0==n?t.substring(0,e):t.substring(n,e)}return""}indexOfStartOfCurrentWord(t,e){for(var o=e;o>0&&t.charAt(o-1).match(/\w/);)o--;return o}inputHasCharactersOtherThanLetters(t){return/[^a-zA-Z\s]/.test(t)}inputIsEmpty(t){return""===t}inputIsNotValid(t){return this.inputHasCharactersOtherThanLetters(t)||this.inputIsEmpty(t)}async getSuggestions(t){if(this.inputIsNotValid(t))return[];let e=this.wordCompleteModel.predictCurrentWord(t);return typeof e==Promise?await e:e}async getNextWordSuggestion(t){let e=this.wordPredictModel.predictNextWord(t);return typeof e==Promise?await e:e}handleUserInput(t){n.activeElementIsServiceable()&&this.enabled&&this.displaySuggestions()}handleWordComplete(t){if(this.enable){var e=t.key;if(n.activeElementIsServiceable()&&this.shortcuts.includes(e)&&this.displayStrategy.isActive()){t.preventDefault();var o=this.mappings[e];this.wordCompletion(this.document.activeElement,o)}}}registerListeners(){this.document.addEventListener("keydown",this.handleWordComplete.bind(this)),this.document.addEventListener("keyup",this.handleUserInput.bind(this));for(var t=n.getServicableElements(),e=0;e<t.length;e++)t[e].addEventListener("blur",function(){this.displayStrategy.tearDown(),console.log(this.displayStrategy)}.bind(this))}enable(){this.enabled=!0}disable(){this.enabled=!1}disableWordPrediction(){this.wordPredictEnabled=!1}disableWordCompletion(){this.wordCompleteEnabled=!1}enableWordPrediction(){this.wordPredictEnabled=!0}enableWordCompletion(){this.wordCompleteEnabled=!0}configureDisplay(t){this.displayStrategy.config(t)}}},function(t,e){var o="input[type=text], textarea, [contenteditable=true], [contenteditable]",n=["input[type=text]","textarea","[contenteditable=true]","[contenteditable]"],i=["[contenteditable=true]","[contenteditable]"];function r(t,e){let o=e,n="";for(;o!=t;){for(;null!=o.previousSibling;)n=(o=o.previousSibling).textContent+n,["P","DIV"].includes(o.tagName)&&(n=" "+n);o=o.parentNode,["P","DIV"].includes(o.tagName)&&(n=" "+n)}return n}t.exports={isContentEditableDiv:function(t){if("DIV"==t.tagName)for(let e of i)if(t.matches(e))return!0;return!1},getServicableElements:function(){return document.querySelectorAll(o)},activeElementIsServiceable:function(){let t=document.activeElement;for(let e=0;e<n.length;e++)if(t.matches(n[e]))return!0;return!1},caretAndTextOfEditableDiv:function(t,e){if(t==e)return window.getSelection().anchorOffset;let o=r(t,e);return{text:o,caret:o.length+window.getSelection().anchorOffset}},getTextUpToChildInEditableDiv:r}},function(t,e,o){const n=o(4);t.exports=class{constructor(t){this.dom=t,this.ID="suggestions",this.current_table=null,this.style=new n}createSuggestionsTable(){let t=this.dom,e=t.createElement("table");return e.id=this.ID,e.className="suggestions",this.style.table(e,t.activeElement),this.current_table=e,e}isActive(){return null!=this.dom.getElementById(this.ID)}tearDown(){this.isActive()&&this.current_table.parentNode.removeChild(this.current_table)}display(t){for(var e=this.dom,o=this.createSuggestionsTable(),n=Object.values(t),i=Object.keys(t),r=0;r<n.length;r++){var s=e.createElement("tr");this.style.row(s);var l=e.createElement("td"),a=e.createElement("td");l.appendChild(e.createTextNode(i[r].toString())),a.appendChild(e.createTextNode(n[r])),s.append(l),s.append(a),o.appendChild(s)}e.body.appendChild(o),this.style.updatePosition(o)}config(t){this.style.settings=t}}},function(t,e,o){const n=o(5);t.exports=class{constructor(){this.cache={},this.offset_y=0}table(t,e){t.style.display="flex",t.style.position="absolute",t.style.backgroundColor="lightblue",t.style.zIndex=999;const o=e.getBoundingClientRect(),i=n(e,e.selectionStart);this.offset_y=window.getComputedStyle(e,"").fontSize,this.offset_y=this.pxToInt(this.offset_y)-e.scrollTop,t.style.top=(o.top+i.top+this.offset_y).toString()+"px",t.style.left=(o.left+i.left).toString()+"px"}updatePosition(t){const e=window.innerWidth,o=window.innerHeight,n=t.getBoundingClientRect(),i=this.pxToInt(t.style.left),r=this.pxToInt(t.style.top);if(console.log("Mishiii",e,n.right),console.log(n),n.right>e){const o=n.right-e;t.style.left=(i-o).toString()+"px"}if(n.bottom>o){const e=2*this.offset_y+parseInt(this.settings.fontsize);t.style.top=(r-e).toString()+"px"}}pxToInt(t){return parseInt(t.slice(0,t.length-2))}row(t,e=6){t.style.marginRight=e.toString()+"px",this.settings&&(t.style.fontFamily=this.settings.font,t.style.fontSize=this.settings.fontsize+"px",t.style.color=this.settings.fontcolor,t.style.fontWeight=this.settings.fontstyle.toLowerCase())}calcSize(t,e={}){const o=JSON.stringify({text:t,options:e});if(this.cache[o])return this.cache[o];e.font=e.font||"Times",e.fontSize=e.fontSize||"16px",e.fontWeight=e.fontWeight||"normal",e.lineHeight=e.lineHeight||"normal",e.width=e.width||"auto",e.wordBreak=e.wordBreak||"normal";const n=this.createDummyElement(t,e),i={width:n.offsetWidth,height:n.offsetHeight};return this.destroyElement(n),this.cache[o]=i,i}destroyElement(t){t.parentNode.removeChild(t)}createDummyElement(t,e){const o=document.createElement("div"),n=document.createTextNode(t);return o.appendChild(n),o.style.fontFamily=e.font,o.style.fontSize=e.fontSize,o.style.fontWeight=e.fontWeight,o.style.lineHeight=e.lineHeight,o.style.position="absolute",o.style.visibility="hidden",o.style.left="-999px",o.style.top="-999px",o.style.width=e.width,o.style.height="auto",o.style.wordBreak=e.wordBreak,document.body.appendChild(o),o}}},function(t,e,o){!function(){var e=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],o="undefined"!=typeof window,n=o&&null!=window.mozInnerScreenX;function i(t,i,r){if(!o)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var s=r&&r.debug||!1;if(s){var l=document.querySelector("#input-textarea-caret-position-mirror-div");l&&l.parentNode.removeChild(l)}var a=document.createElement("div");a.id="input-textarea-caret-position-mirror-div",document.body.appendChild(a);var d=a.style,c=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,u="INPUT"===t.nodeName;d.whiteSpace="pre-wrap",u||(d.wordWrap="break-word"),d.position="absolute",s||(d.visibility="hidden"),e.forEach(function(t){u&&"lineHeight"===t?d.lineHeight=c.height:d[t]=c[t]}),n?t.scrollHeight>parseInt(c.height)&&(d.overflowY="scroll"):d.overflow="hidden",a.textContent=t.value.substring(0,i),u&&(a.textContent=a.textContent.replace(/\s/g,"Â "));var h=document.createElement("span");h.textContent=t.value.substring(i)||".",a.appendChild(h);var p={top:h.offsetTop+parseInt(c.borderTopWidth),left:h.offsetLeft+parseInt(c.borderLeftWidth),height:parseInt(c.lineHeight)};return s?h.style.backgroundColor="#aaa":document.body.removeChild(a),p}void 0!==t.exports?t.exports=i:o&&(window.getCaretCoordinates=i)}()},function(t,e){t.exports={applySettings:function(t){chrome.storage.local.get(function(e){if(null!=e){console.log("Current word enabled: "+e["Current Word"]),console.log("Next word enables: "+e["Next Word"]),e.activated||(console.log("Disabled upon init"),t.disable()),e["Current Word"]||t.disableWordCompletion(),e["Next Word"]||t.disableWordPrediction();let o={font:e.Font,fontsize:e["Font Size"],fontstyle:e["Font Style"],fontcolor:e["Font Color"]};t.configureDisplay(o),function(t){chrome.runtime.onMessage.addListener(function(e,o,n){console.log("received message: "+e),"enableTabX"==e?(t.enable(),console.log("I was enabled")):"disableTabX"==e?(t.disable(),console.log("I was disabled")):"enableWordPrediction"==e?(console.log("enabled Word Prediction"),t.enableWordPrediction()):"enableWordCompletion"==e?(console.log("enabled Word Completion"),t.enableWordCompletion()):"disableWordPrediction"==e?(console.log("disabled Word Prediction"),t.disableWordPrediction()):"disableWordCompletion"==e?(console.log("disabled Word Completion"),t.disableWordCompletion()):"updateDisplay"==e&&chrome.storage.local.get(function(e){let o={font:e.Font,fontsize:e["Font Size"],fontstyle:e["Font Style"],fontcolor:e["Font Color"]};t.configureDisplay(o)})})}(t)}})}}},function(t,e){async function o(t,e){let o=new Promise(function(o,n){console.log("MSG: "+t+"("+e+")"+typeof e),chrome.runtime.sendMessage({TabxOp:t,TabxInput:e},function(t){o(t.TabxResults)})});console.log("before results");let n=await o;return console.log("after results: "+n),n}var n={predictCurrentWord:function(t){return o("WORD_COMPLETE",t)}},i={predictNextWord:function(t){return o("WORD_PREDICT",t)}};t.exports={WordCompleteModel:n,WordPredictModel:i}}]);